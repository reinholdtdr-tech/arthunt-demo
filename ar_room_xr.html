<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>ARtHunt – XR-Galerieraum</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        overflow: hidden;
        background: #000;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #fff;
      }

      #overlay {
        position: fixed;
        inset: 0;
        pointer-events: none;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 0.75rem;
        z-index: 5;
      }

      #topBar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.75rem;
        background: linear-gradient(90deg, #141e30, #243b55);
        border-radius: 999px;
        padding: 0.5rem 0.9rem;
        font-size: 0.85rem;
        pointer-events: auto;
      }

      #topBar span {
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      #backBtn {
        border: none;
        border-radius: 999px;
        padding: 0.35rem 0.8rem;
        font-size: 0.8rem;
        background: rgba(255, 255, 255, 0.12);
        color: #fff;
        cursor: pointer;
      }

      #bottomMsg {
        align-self: center;
        background: rgba(0, 0, 0, 0.75);
        border-radius: 999px;
        padding: 0.6rem 1.1rem;
        font-size: 0.8rem;
        max-width: 90vw;
        text-align: center;
      }

      #bottomMsg strong {
        font-weight: 600;
      }
    </style>

    <!-- A-Frame mit WebXR-Unterstützung -->
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>

    <script>
      // dieselben 7 Bilder wie in deinen anderen Szenen
      const ROOM_IMAGES = [
        "20251102_1707_Brücke im Rembrandt-Stil_remix_01k92n2vsqee2rjsqxe12cz19g.png",
        "20251105_2137_Weihnachtslandschaft à la Van Gogh_simple_compose_01k9avpygheafv8mmb9ycav852.png",
        "20251102_1618_Van Gogh Stilbrücke_remix_01k92j85azezrrerbzhgw95hgm.png",
        "20251027_2116_Van Gogh's Prague Impression_simple_compose_01k8kmxe1xefda9a7k536jxjs0 (1).png",
        "20251105_2134_Weihnachtslandschaft à la van Gogh_simple_compose_01k9avhp31fq3affv1c07y74ta.png",
        "20251030_1420_Van Gogh's Charles Bridge_remix_01k8tm9crpedysvyykbpw44a7y.png",
        "20251102_1623_Picasso-Interpretation_remix_01k92jh05me2g9j6prbcntxxfq.png"
      ];

      // White-Cube-Galerieraum (ohne GPS, alles relativ zum gallery-root)
      AFRAME.registerComponent("gallery-room", {
        schema: {
          size: { type: "number", default: 6 }, // Breite/Tiefe
          height: { type: "number", default: 3 }, // Wandhöhe
          wallThickness: { type: "number", default: 0.1 },
          pictureHeight: { type: "number", default: 1.7 }, // Augenhöhe Mitte Bild
          pictureWidth: { type: "number", default: 1.4 },
          pictureHeightPlane: { type: "number", default: 0.9 }
        },
        init: function () {
          const el = this.el;
          const d = this.data;

          const half = d.size / 2;
          const h = d.height / 2;

          // ---------- WÄNDE ----------
          const wallMat =
            "color: #f5f5f5; roughness: 0.9; metalness: 0.0; side: double";

          // Vorderwand (Z negativ)
          const frontWall = document.createElement("a-box");
          frontWall.setAttribute("width", d.size);
          frontWall.setAttribute("height", d.height);
          frontWall.setAttribute("depth", d.wallThickness);
          frontWall.setAttribute("position", `0 ${h} -${half}`);
          frontWall.setAttribute("material", wallMat);
          el.appendChild(frontWall);

          // Rückwand (Z positiv)
          const backWall = document.createElement("a-box");
          backWall.setAttribute("width", d.size);
          backWall.setAttribute("height", d.height);
          backWall.setAttribute("depth", d.wallThickness);
          backWall.setAttribute("position", `0 ${h} ${half}`);
          backWall.setAttribute("material", wallMat);
          el.appendChild(backWall);

          // Linke Wand (X negativ)
          const leftWall = document.createElement("a-box");
          leftWall.setAttribute("width", d.size);
          leftWall.setAttribute("height", d.height);
          leftWall.setAttribute("depth", d.wallThickness);
          leftWall.setAttribute("rotation", "0 90 0");
          leftWall.setAttribute("position", `-${half} ${h} 0`);
          leftWall.setAttribute("material", wallMat);
          el.appendChild(leftWall);

          // Rechte Wand (X positiv)
          const rightWall = document.createElement("a-box");
          rightWall.setAttribute("width", d.size);
          rightWall.setAttribute("height", d.height);
          rightWall.setAttribute("depth", d.wallThickness);
          rightWall.setAttribute("rotation", "0 90 0");
          rightWall.setAttribute("position", `${half} ${h} 0`);
          rightWall.setAttribute("material", wallMat);
          el.appendChild(rightWall);

          // Boden
          const floor = document.createElement("a-plane");
          floor.setAttribute("width", d.size);
          floor.setAttribute("height", d.size);
          floor.setAttribute(
            "material",
            "color: #e5e7eb; roughness: 1.0; metalness: 0.0"
          );
          floor.setAttribute("rotation", "-90 0 0");
          floor.setAttribute("position", "0 0 0");
          el.appendChild(floor);

          // ---------- BILDER ----------
          const picW = d.pictureWidth;
          const picH = d.pictureHeightPlane;
          const yPic = d.pictureHeight;

          // 3 vorne
          const frontZ = -half + d.wallThickness / 2 + 0.01;
          const frontXs = [-2, 0, 2];
          for (let i = 0; i < 3 && i < ROOM_IMAGES.length; i++) {
            const plane = document.createElement("a-plane");
            plane.setAttribute("width", picW);
            plane.setAttribute("height", picH);
            plane.setAttribute("material", `src: ${ROOM_IMAGES[i]}; side: front`);
            plane.setAttribute(
              "position",
              `${frontXs[i]} ${yPic} ${frontZ + 0.01}`
            );
            plane.setAttribute("rotation", "0 0 0");
            el.appendChild(plane);
          }

          // 3 hinten
          const backZ = half - d.wallThickness / 2 - 0.01;
          const backXs = [-2, 0, 2];
          for (let j = 0; j < 3 && 3 + j < ROOM_IMAGES.length; j++) {
            const plane = document.createElement("a-plane");
            plane.setAttribute("width", picW);
            plane.setAttribute("height", picH);
            plane.setAttribute(
              "material",
              `src: ${ROOM_IMAGES[3 + j]}; side: front`
            );
            plane.setAttribute(
              "position",
              `${backXs[j]} ${yPic} ${backZ - 0.01}`
            );
            plane.setAttribute("rotation", "0 180 0");
            el.appendChild(plane);
          }

          // 1 links
          const leftX = -half + d.wallThickness / 2 + 0.01;
          if (ROOM_IMAGES.length > 6) {
            const plane = document.createElement("a-plane");
            plane.setAttribute("width", picW);
            plane.setAttribute("height", picH);
            plane.setAttribute(
              "material",
              `src: ${ROOM_IMAGES[6]}; side: front`
            );
            plane.setAttribute("position", `${leftX + 0.01} ${yPic} 0`);
            plane.setAttribute("rotation", "0 90 0");
            el.appendChild(plane);
          }

          // Du könntest später die rechte Wand noch nutzen.
        }
      });

      document.addEventListener("DOMContentLoaded", () => {
        const bottomMsg = document.getElementById("bottomMsg");
        const scene = document.querySelector("a-scene");

        // WebXR-Status / Hit-Test-Events für User-Feedback
        scene.addEventListener("enter-vr", function () {
          if (this.is("ar-mode")) {
            bottomMsg.innerHTML =
              "<strong>Scanne den Boden…</strong><br/>Bewege dein Smartphone, bis eine Fläche erkannt wird.";
          }
        });

        scene.addEventListener(
          "ar-hit-test-start",
          function () {
            bottomMsg.innerHTML =
              "<strong>Suche nach Oberfläche…</strong><br/>Bitte langsam bewegen.";
          },
          { once: true }
        );

        scene.addEventListener(
          "ar-hit-test-achieved",
          function () {
            bottomMsg.innerHTML =
              "<strong>Fläche gefunden!</strong><br/>Tippe auf den Bildschirm, um den Galerieraum zu platzieren.";
          },
          { once: true }
        );

        scene.addEventListener(
          "ar-hit-test-select",
          function () {
            bottomMsg.innerHTML =
              "<strong>Galerieraum platziert.</strong><br/>Geh näher heran, oder laufe hinein.";
          },
          { once: true }
        );

        const backBtn = document.getElementById("backBtn");
        backBtn.addEventListener("click", () => {
          if (document.referrer) {
            history.back();
          } else {
            window.location.href = "index.html";
          }
        });
      });
    </script>
  </head>

  <body>
    <!-- DOM-Overlay für Text & Back-Button -->
    <div id="overlay">
      <div id="topBar">
        <span>ARtHunt – XR-Galerieraum</span>
        <button id="backBtn">Zurück</button>
      </div>
      <div id="bottomMsg">
        <strong>AR bereit.</strong><br />Tippe auf „In AR öffnen“ und suche
        eine Fläche.
      </div>
    </div>

    <!-- WebXR-Szene mit Hit-Test -->
    <a-scene
      renderer="colorManagement: true; physicallyCorrectLights: true;"
      vr-mode-ui="enabled: true"
      embedded
      webxr="requiredFeatures: local-floor; optionalFeatures: hit-test,dom-overlay; overlayElement: #overlay;"
      ar-hit-test="target:#gallery-root; type: footprint; footprintDepth: 0.2;"
    >
      <!-- Kamera; WebXR übernimmt Position/Tracking -->
      <a-entity camera look-controls position="0 1.6 0"></a-entity>

      <!-- Galerieraum – wird von ar-hit-test auf dem Boden platziert -->
      <a-entity
        id="gallery-root"
        visible="true"
        gallery-room="size: 6; height: 3; wallThickness: 0.1; pictureHeight: 1.7; pictureWidth: 1.4; pictureHeightPlane: 0.9"
      >
      </a-entity>

      <!-- leichtes Umgebungslicht -->
      <a-entity light="type: ambient; intensity: 0.7;"></a-entity>
      <!-- Richtungslicht -->
      <a-entity
        light="type: directional; intensity: 0.6;"
        position="1 4 2"
      ></a-entity>
    </a-scene>
  </body>
</html>
