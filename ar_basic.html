<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>ARtHunt – AR Viewer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script
    type="module"
    src="https://unpkg.com/@google/model-viewer@3.5.0/dist/model-viewer.min.js"
  ></script>
  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --card: #020617;
      --accent: #22c55e;
      --text: #e5e7eb;
      --muted: #9ca3af;
    }
    * {
      box-sizing: border-box;
    }
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: #000;
      color: var(--text);
    }
    body {
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 0.6rem 0.85rem;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      background: radial-gradient(
          circle at top left,
          rgba(34, 197, 94, 0.3),
          transparent 60%
        ),
        rgba(15, 23, 42, 0.96);
      backdrop-filter: blur(14px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
      z-index: 2;
    }
    .titles {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .titles h1 {
      font-size: 0.95rem;
      margin: 0;
      font-weight: 600;
    }
    .titles span {
      font-size: 0.75rem;
      color: var(--muted);
    }
    .btn-close {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text);
      padding: 0.3rem 0.7rem;
      font-size: 0.78rem;
      cursor: pointer;
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      background: #000;
    }
    model-viewer {
      width: 100%;
      height: 100%;
      background-color: #000;
    }
    .controls {
      position: fixed;
      left: 0.5rem;
      right: 0.5rem;
      bottom: 0.6rem;
      padding: 0.55rem 0.7rem 0.55rem;
      border-radius: 1rem;
      background: radial-gradient(
          circle at top left,
          rgba(34, 197, 94, 0.28),
          transparent 60%
        ),
        rgba(15, 23, 42, 0.96);
      backdrop-filter: blur(18px);
      box-shadow: 0 -18px 50px rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      font-size: 0.8rem;
      z-index: 3;
    }
    .control-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .control-row label {
      min-width: 70px;
      color: var(--muted);
      font-size: 0.78rem;
    }
    input[type="range"] {
      flex: 1;
    }
    .ar-button {
      margin-top: 0.25rem;
      border-radius: 999px;
      border: none;
      padding: 0.45rem 0.7rem;
      font-size: 0.8rem;
      font-weight: 500;
      background: linear-gradient(
        to right,
        #22c55e,
        #4ade80
      );
      color: #022c22;
      cursor: pointer;
      box-shadow: 0 12px 35px rgba(34, 197, 94, 0.7);
    }
  </style>
</head>
<body>
  <header>
    <div class="titles">
      <h1 id="title">ARtHunt – AR</h1>
      <span id="subtitle"></span>
    </div>
    <button class="btn-close" onclick="goBack()">Zurück</button>
  </header>
  <main>
    <model-viewer
      id="viewer"
      autoplay
      camera-controls
      ar
      ar-modes="webxr scene-viewer quick-look"
      exposure="1"
      shadow-intensity="0.9"
      shadow-softness="0.8"
      environment-image="neutral"
    ></model-viewer>
  </main>
  <div class="controls">
    <div class="control-row">
      <label for="sizeRange">Größe</label>
      <input id="sizeRange" type="range" min="50" max="200" value="100" />
    </div>
    <div class="control-row">
      <label for="rotRange">Drehung (Y)</label>
      <input id="rotRange" type="range" min="0" max="360" value="0" />
    </div>
    <button class="ar-button" id="btnPlaceAr">In AR platzieren</button>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const title = params.get("title") || "ARtHunt – AR";
    const subtitle = params.get("subtitle") || "";
    const glb = params.get("glb");
    const usdz = params.get("usdz");
    const scaleParam = parseFloat(params.get("scale") || "100");
    const rotParam = parseFloat(params.get("rot") || "0");

    document.getElementById("title").textContent = title;
    document.getElementById("subtitle").textContent = subtitle;

    const viewer = document.getElementById("viewer");
    const sizeRange = document.getElementById("sizeRange");
    const rotRange = document.getElementById("rotRange");
    const btnPlaceAr = document.getElementById("btnPlaceAr");

    if (glb) {
      viewer.src = glb;
    }
    if (usdz) {
      viewer.setAttribute("ios-src", usdz);
    }

    function applyScale(val) {
      const s = (val || 100) / 100;
      viewer.scale = `${s} ${s} ${s}`;
    }
    function applyRotation(val) {
      const r = val || 0;
      viewer.orientation = `0deg ${r}deg 0deg`;
    }

    sizeRange.value = scaleParam;
    rotRange.value = rotParam;
    applyScale(scaleParam);
    applyRotation(rotParam);

    sizeRange.addEventListener("input", () => {
      applyScale(parseFloat(sizeRange.value));
    });
    rotRange.addEventListener("input", () => {
      applyRotation(parseFloat(rotRange.value));
    });

    btnPlaceAr.addEventListener("click", () => {
      viewer.activateAR();
    });

    function goBack() {
      if (document.referrer) {
        history.back();
      } else {
        window.location.href = "./";
      }
    }
    window.goBack = goBack;
  </script>
</body>
</html>
